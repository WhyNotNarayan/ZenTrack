<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="/analytics.css">
  <title>ZenTrack - Analytics</title>
</head>
<body class="analytics-body">

  <aside class="sidebar">
    <div class="sidebar-header">
      <h2 class="brand-logo" style="font-weight:800; color:var(--text-main);">
        Zen<span style="color:#6366f1;">Track</span>
      </h2>
    </div>
    <nav class="nav flex-column mt-4">
      <a href="/" class="nav-link text-muted mb-2"><i class="fas fa-calendar-check me-2"></i> <span>Tracker</span></a>
      <a href="/goals" class="nav-link text-muted mb-2"><i class="fas fa-plus-circle me-2"></i> <span>Manage Goals</span></a>
      <a href="/analytics" class="nav-link active fw-bold mb-2" style="color:#6366f1; background: rgba(99,102,241,0.1); border-radius:10px;">
        <i class="fas fa-chart-pie me-2"></i> <span>Analytics</span>
      </a>
    </nav>
  </aside>

  <main class="main-content">
    <header class="d-flex justify-content-between align-items-center mb-5">
      <div>
        <h1 class="fw-bold mb-0">Performance Insights</h1>
        <p class="text-muted">Visualize your habit consistency</p>
      </div>
      <a href="/" class="btn btn-outline-primary rounded-pill px-4">
        <i class="fas fa-arrow-left me-2"></i> Back to Tracker
      </a>
    </header>

    <div class="analytics-grid">
      <div class="chart-card" style="grid-column: span 2;">
        <h2>Consistency Trend</h2>
        <canvas id="lineChart" height="100"></canvas>
      </div>

      <div class="chart-card">
        <h2>Daily Completion</h2>
        <canvas id="columnChart"></canvas>
      </div>

      <div class="chart-card">
        <h2>Distribution</h2>
        <div class="pie-wrapper">
          <canvas id="pieChart"></canvas>
        </div>
      </div>
    </div>
  </main>

 <script>
  const labels = <%- dates %>;
  const dataValues = <%- dataValues %>;

  // Line Chart
  new Chart(document.getElementById('lineChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Completed Tasks',
        data: dataValues,
        borderColor: '#6366f1',
        backgroundColor: 'rgba(99, 102, 241, 0.1)',
        fill: true,
        tension: 0.4,
        pointRadius: 4,
        pointBackgroundColor: '#6366f1'
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, grid: { display: false } },
        x: { grid: { display: false } }
      }
    }
  });

  // Bar Chart
  new Chart(document.getElementById('columnChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        data: dataValues,
        backgroundColor: '#6366f1',
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, border: { display: false } },
        x: { border: { display: false } }
      }
    }
  });

  // Pie Chart
  new Chart(document.getElementById('pieChart'), {
    type: 'doughnut',
    data: {
      labels: ['Completed', 'Remaining'],
      datasets: [{
        data: [<%= completedCount %>, <%= notCompletedCount %>],
        backgroundColor: ['#6366f1', '#e2e8f0'],
        borderWidth: 0
      }]
    },
    options: {
      cutout: '70%',
      plugins: { legend: { position: 'bottom' } }
    }
  });
</script>
</body>
</html>